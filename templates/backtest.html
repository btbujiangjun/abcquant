{% extends "base.html" %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="static/ui.js"></script>
<style>
#backtest-container { width: 99%; height: 600px; margin-top: 20px; }
.section {background: white;border-radius: 8px;box-shadow: 0 4px 10px rgba(0,0,0,0.08);padding: 6px;}
.section-grid {display: grid;grid-template-columns: repeat(auto-fill, minmax(98%, 1fr));gap: 12px;}
.section-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 2px;}
table {width: 100%;border-collapse: collapse;margin-bottom: 10px;font-size: 14px;}
th, td {padding: 8px 10px;border: 1px solid #ddd;text-align: center;}
th {background-color: #f8f8f8;}
tbody tr:hover {background-color: #f9f9f9;}
h1 {
    text-align: left;
    margin-top: 20px;
    margin-bottom: 30px;
    width: 100%;
}
/* æ ¸å¿ƒå®¹å™¨ï¼šæ°´å¹³å¹¶æ’ */
.pos-header-grid {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 2px 2px;
    background: linear-gradient(to bottom, #ffffff, #f8fafc);
    border-radius: 4px;
    margin-bottom: 2px;
}
/* å‚ç›´åˆ†å‰²çº¿ */
.pos-divider {
    width: 1px;
    height: 60px;
    background: #e2e8f0;
}
/* æ ¸å¿ƒå—å¸ƒå±€ */
.pos-block {
    flex: 1;
    text-align: center;
}
.pos-label {
    font-size: 13px;
    color: #64748b;
    margin-bottom: 2px;
    font-weight: 500;
}

/* å¤§å°ºå¯¸æ•°å€¼ */
.pos-val-ops { font-size: 28px; font-weight: 900; line-height: 1; }
.pos-val-num { font-size: 32px; font-weight: 800; line-height: 1; }

/* å¼±åŒ–åçš„åº•éƒ¨æ•°æ®æ  */
.pos-footer-metrics {
    display: flex;
    justify-content: center;
    gap: 5px;
    padding: 5px 0;
    font-size: 14px;
    color: #94a3b8;
}
.pos-footer-metrics b { color: #4f46e5; }
#gaugeCanvas {
    display: block;   /* å¿…é¡»è½¬ä¸ºå—çº§ */
    margin: 0 auto;  /* æ°´å¹³å±…ä¸­ */
}
.pos-status-hint {
    display: flex;
    justify-content: center;
    gap: 15px;
    padding: 10px 0;
    border-top: 1px dashed #e2e8f0;
    font-size: 14px;
    color: #0f172a;
}
.text-buy { color: #22c55e; }
.text-sell { color: #dc2626; }
a {     
    color: #111827;
    text-decoration: none;
    transition: color 0.2s ease;
}       
a:hover {
    color: var(--accent);
    text-decoration: none;
}

</style>
<h1>ğŸ²<span class="gradient-h1-title">è‚¡ç¥¨å›æµ‹</span>ğŸ¯</h1>
<div class="toolbar">
  <select id="stockSelector"></select>
  <input type="text" id="symbol_text" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°æœç´¢">
  <select id="routing" placeholder="é€‰æ‹©è·¯ç”±æ¨¡å¼">
    <option value="ai" selected>æ™ºèƒ½æ¨¡å¼</option>
    <option value="online">å®æ—¶æ¨¡å¼</option>
  </select>
  <label>å›æµ‹å‘¨æœŸ</label>
  <select id="duration" placeholder="é€‰æ‹©å›æµ‹å‘¨æœŸ">
    <option value="">é€‰æ‹©å‘¨æœŸæˆ–æ—¶é—´</option>
    <option value="30">è¿‘ä¸€æœˆ</option>
    <option value="90">è¿‘ä¸‰æœˆ</option>
    <option value="160">è¿‘å…­æœˆ</option>
    <option value="360">è¿‘ä¸€å¹´</option>
    <option value="720">è¿‘ä¸¤å¹´</option>
    <option value="1080">è¿‘ä¸‰å¹´</option>
  </select>
  <label for="startDate">èµ·å§‹æ—¥æœŸ</label>
  <input type="date" id="startDate" value="">
  <label for="endDate">ç»“æŸæ—¥æœŸ</label>
  <input type="date" id="endDate" value="">
  <button onclick="doBacktest()">æŸ¥è¯¢</button>
</div>
<div class="section-grid">
  <div class="section">
    <div class="section-header">
        <h3><span class="gradient-title">å®æ—¶å¤´å¯¸å»ºè®®</span></h3>
    </div>
    <div class="pos-header-grid">
        <div class="pos-block">
            <div class="pos-label">è‚¡ç¥¨ä»£ç </div>
            <div id="kellySymbol" class="pos-val-ops text-buy">...</div>
        </div>
        <div class="pos-divider"></div>
        <div class="pos-block">
            <div class="pos-label">æ“ä½œå»ºè®®</div>
            <div id="kellyOps" class="pos-val-ops text-buy">...</div>
        </div>
        <div class="pos-divider"></div>
        <div class="pos-block">
            <div class="pos-label">å»ºè®®ä»“ä½</div>
            <div id="kellyPos" class="pos-val-num text-sell">0.0%</div>
        </div>
        <div class="pos-divider"></div>
        <canvas id="gaugeCanvas" width="260" height="120" style="opacity: 0.8;"></canvas>
        <div class="pos-divider"></div>
        <div class="pos-footer-metrics">
            <span>å¾—åˆ†: <b id="kellyScore">0</b><br>ç½®ä¿¡åº¦: <b id="kellyConfience">0</b></span>
        </div>
    </div>
    <div id="kellyInterpretation" class="pos-status-hint"></div>
  </div>
  <div class="section">
    <table>
      <thead><tr>
        <th>æ’å</th>
        <th>ç­–ç•¥</th>
        <th>æ€»æ”¶ç›Šç‡</th>
        <th>å¹´åŒ–æ”¶ç›Š</th>
        <th>æœ€å¤§å›æ’¤</th>
        <th>ç›ˆäºæ¯”</th>
        <th>æŒ‰å¤©èƒœç‡</th>
        <th>æŒ‰ç¬”èƒœç‡</th>
        <th>å¤æ™®æ¯”ç‡</th>
        <th>å¡ç›æ¯”ç‡</th>
        <th>äº¤æ˜“ç¬”æ•°</th>
        <th>å½“å‰çŠ¶æ€</th>
        <th>æœ€è¿‘ç›ˆåˆ©</th>
        <th>äº¤æ˜“/æŒä»“/ç©ºä»“å¤©æ•°</th>
        <th>å¯»ä¼˜å‚æ•°</th>
        <th>å›æµ‹å‘¨æœŸ</th>
      </tr></thead>
      <tbody id="strategy_summary"><tr><td colspan="16">æš‚æ— æ•°æ®</td></tr></tbody>
    </table>
  </div>
  <div class="section">
    <div style="text-align: center;"><span class="gradient-title" id="mainTitle">ç­–ç•¥å›æµ‹åˆ†æ</span></div>
    <div class="section" id="backtest-container"></div>
  </div>
</div>
<script src="/static/backtest.js"></script>
{% endblock %}
